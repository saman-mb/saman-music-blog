{% assign default_paths = site.pages | map: "path" %}
{% assign page_paths = site.header_pages | default: default_paths %}

<header class="site-header">
  <div class="wrapper">
    <div class="header-left">
      <a class="site-title" rel="author" href="{{ "/" | relative_url }}">{{ site.title | escape }}</a>
    </div>

    {%- if page_paths -%}
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="m18,1.484c0,0.82-0.665,1.484-1.484,1.484h-15.032c-0.819,0-1.484-0.665-1.484-1.484s0.665-1.484,1.484-1.484h15.032c0.819,0,1.484,0.665,1.484,1.484zm0,6.016c0,0.82-0.665,1.484-1.484,1.484h-15.032c-0.819,0-1.484-0.665-1.484-1.484s0.665-1.484,1.484-1.484h15.032c0.819,0,1.484,0.665,1.484,1.484zm0,6.016c0,0.82-0.665,1.484-1.484,1.484h-15.032c-0.819,0-1.484-0.665-1.484-1.484s0.665-1.484,1.484-1.484h15.032c0.819,0,1.484,0.665,1.484,1.484z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <a class="page-link {% if page.url == '/' %}active{% endif %}" href="{{ "/" | relative_url }}">Home</a>
          <a class="page-link {% if page.url contains '/gear-analysis/' %}active{% endif %}" href="{{ "/gear-analysis/" | relative_url }}">Gear Analysis</a>
          <a class="page-link {% if page.url contains '/sampling-research/' %}active{% endif %}" href="{{ "/sampling-research/" | relative_url }}">Sampling Research</a>
          <a class="page-link {% if page.url contains '/production-techniques/' %}active{% endif %}" href="{{ "/production-techniques/" | relative_url }}">Production Techniques</a>
          <a class="page-link {% if page.url contains '/music-archaeology/' %}active{% endif %}" href="{{ "/music-archaeology/" | relative_url }}">Music Archaeology</a>
          <a class="page-link {% if page.url contains '/about/' %}active{% endif %}" href="{{ "/about/" | relative_url }}">About</a>
        </div>
      </nav>
    {%- endif -%}

    <!-- header-right: dark mode toggle -->
    <div class="header-right">
      <button id="dark-mode-toggle" class="dark-toggle" aria-pressed="false" title="Toggle dark mode">
        <span class="icon-sun" aria-hidden="true">‚òÄÔ∏è</span>
        <span class="icon-moon" aria-hidden="true">üåô</span>
      </button>
    </div>
  </div>
</header>

<script>
  // Initialise theme on page load and bind toggle
  (function() {
    var root = document.documentElement;
    var toggle = document.getElementById('dark-mode-toggle');
    if (!toggle) return;

    function applyTheme(t) {
      if (t === 'dark') {
        root.classList.add('dark-mode');
        toggle.setAttribute('aria-pressed', 'true');
      } else {
        root.classList.remove('dark-mode');
        toggle.setAttribute('aria-pressed', 'false');
      }
    }

    // Determine initial preference: localStorage -> system preference -> light
    var stored = null;
    try { stored = localStorage.getItem('theme'); } catch (e) { stored = null; }

    if (stored === 'dark' || (!stored && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      applyTheme('dark');
    } else {
      applyTheme('light');
    }

    // Sync icon visuals
    function updateIcons() {
      var sun = toggle.querySelector('.icon-sun');
      var moon = toggle.querySelector('.icon-moon');
      if (root.classList.contains('dark-mode')) {
        if (sun) sun.style.display = 'none';
        if (moon) moon.style.display = 'inline';
      } else {
        if (sun) sun.style.display = 'inline';
        if (moon) moon.style.display = 'none';
      }
    }

    updateIcons();

    toggle.addEventListener('click', function() {
      var isDark = root.classList.toggle('dark-mode');
      try { localStorage.setItem('theme', isDark ? 'dark' : 'light'); } catch(e){}
      toggle.setAttribute('aria-pressed', isDark ? 'true' : 'false');
      updateIcons();
    });

    // Listen for system preference changes if user hasn't explicitly set a preference
    try {
      if (!stored && window.matchMedia) {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
          applyTheme(e.matches ? 'dark' : 'light');
          updateIcons();
        });
      }
    } catch (e) { /* ignore */ }
  })();
</script>
